<div class="edit-product">
  <ng-container *ngIf="loading(); else content">
    <p class="edit-product__loading">Loading product...</p>
  </ng-container>

  <ng-template #content>
    <ng-container *ngIf="!error(); else errorTpl">
      <form [formGroup]="form" (ngSubmit)="onSave()">
        <header class="header">
          <h1 class="header__title">{{ data()?.id }}</h1>

          <div class="header__actions">
            <div class="header__splitter">
              <button class="header__button header__button--edit" (click)="onEdit()">
                <img src="assets/icons/edit.svg" alt="">
                Edit
              </button>
            </div>
            <div>
              <img src="assets/icons/back.svg" class="header__img" (click)="onBack()" />
              <img src="assets/icons/back.svg" class="header__img" style="transform: rotate(180deg)"
                (click)="onForward()" />
            </div>
            <img src="assets/icons/maximize.svg" class="header__img" (click)="onClose()" />
            <img src="assets/icons/close.svg" class="header__img" (click)="onClose()" />
          </div>
        </header>


        <main>
          <div class="edit-product__grid">
            <!-- LEFT SECTION -->
            <div class="edit-product__left">
              <div class="edit-product__field">
                <label for="brand">Brand</label>
                <div class="edit-product__input-img">
                  <input id="brand" type="text" formControlName="brand" />
                  <div class="edit-product__input-img-block">
                    <img src="assets/icons/arrow-circle.svg" alt="">
                  </div>
                </div>
              </div>

              <div class="edit-product__field">
                <label for="model">Model/Series</label>
                <div class="edit-product__input-img">
                  <input id="model" type="text" formControlName="model" />
                  <div class="edit-product__input-img-block"></div>
                </div>
              </div>

              <div class="edit-product__field">
                <label for="devicePN">Devise P/N</label>
                <div class="edit-product__input-img">
                  <input id="devicePN" type="text" formControlName="devicePN" />
                  <div class="edit-product__input-img-block"></div>
                </div>
              </div>

              <div class="edit-product__field">
                <label for="devType">Dev. Type</label>
                <div class="edit-product__input-img">
                  <input id="devType" type="text" formControlName="devType" />
                  <div class="edit-product__input-img-block"></div>
                </div>
              </div>

              <div class="edit-product__field">
                <label for="rnk">RNK</label>
                <div class="edit-product__input-img">
                  <input id="rnk" type="number" formControlName="rnk" />
                  <div class="edit-product__input-img-block"></div>
                </div>
              </div>

              <div class="edit-product__field">
                <label for="minPrice">Min Price</label>
                <div class="edit-product__input-img">
                  <input id="minPrice" type="number" formControlName="minPrice" />
                  <div class="edit-product__input-img-block"></div>
                </div>
              </div>

              <div class="edit-product__field">
                <label for="maxPrice">Max Price</label>
                <div class="edit-product__input-img">
                  <input id="maxPrice" type="number" formControlName="maxPrice" />
                  <div class="edit-product__input-img-block"></div>
                </div>
              </div>

              <div class="edit-product__field">
                <label for="quantity">Quantity</label>
                <div class="edit-product__input-img">
                  <input id="quantity" type="number" formControlName="quantity" />
                  <div class="edit-product__input-img-block"></div>
                </div>
              </div>

              <div class="edit-product__field">
                <label for="EPrq">EPrq</label>
                <div class="edit-product__input-img">
                  <input id="ePrq" type="text" formControlName="ePrq" />
                  <div class="edit-product__input-img-block"></div>
                </div>
              </div>

              <div class="edit-product__field">
                <label for="EA4q">EA4q</label>
                <div class="edit-product__input-img">
                  <input id="eA4q" type="text" formControlName="eA4q" />
                  <div class="edit-product__input-img-block"></div>
                </div>
              </div>

              <div class="edit-product__field">
                <label for="Photo_device">Photo_device</label>
                <div class="edit-product__input-img">
                  <input id="photoDevice" type="text" formControlName="photoDevice" />
                  <div class="edit-product__input-img-block">
                    <img src="assets/icons/open.svg" alt="">
                  </div>
                </div>
              </div>
            </div>

            <!-- CENTER SECTION -->
            <div class="edit-product__center">
              <div class="edit-product__field">
                <label for="sku">SKU</label>
                <div class="edit-product__input-img">
                  <input id="sku" type="text" formControlName="sku" />
                  <div class="edit-product__input-img-block">
                    <img src="assets/icons/arrow-circle.svg" alt="">
                  </div>
                </div>
              </div>

              <div class="edit-product__field">
                <label for="lUser">L-User</label>
                <div class="edit-product__input-img">
                  <input id="lUser" type="text" formControlName="lUser" />
                  <div class="edit-product__input-img-block">
                    <img src="assets/icons/arrow-circle.svg" alt="">
                  </div>
                </div>
              </div>

              <div class="edit-product__field">
                <label for="category">Category</label>
                <div class="edit-product__input-img">
                  <input id="category" type="text" formControlName="category" />
                  <div class="edit-product__input-img-block">
                    <img src="assets/icons/arrow-circle.svg" alt="">
                  </div>
                </div>
              </div>

              <div class="edit-product__field">
                <label for="eUser">E-User</label>
                <div class="edit-product__input-img">
                  <input id="eUser" type="text" formControlName="eUser" />
                  <div class="edit-product__input-img-block">
                    <img src="assets/icons/arrow-circle.svg" alt="">
                  </div>
                </div>
              </div>

              <div class="edit-product__field">
                <label for="greenId">Green ID</label>
                <div class="edit-product__input-img">
                  <input id="greenId" type="text" formControlName="greenId" />
                  <div class="edit-product__input-img-block"></div>
                </div>
              </div>

              <div class="edit-product__field">
                <label for="editAt">Edit At</label>
                <div class="edit-product__input-img">
                  <input id="editAt" type="text" formControlName="editAt" />
                  <div class="edit-product__input-img-block"></div>
                </div>
              </div>

              <div class="edit-product__field">
                <label for="createAt">Create At</label>
                <div class="edit-product__input-img">
                  <input id="createAt" type="text" formControlName="createAt" />
                  <div class="edit-product__input-img-block"></div>
                </div>
              </div>

              <div class="edit-product__field">
                <label for="amazonLink">Amazon Listing Src</label>
                <div class="edit-product__input-img">
                  <input id="amazonLink" type="text" formControlName="amazonLink" />
                  <div class="edit-product__input-img-block">
                    <img src="assets/icons/open.svg" alt="">
                  </div>
                </div>
              </div>

              <div class="edit-product__field">
                <label for="elccq">ELCCq</label>
                <div class="edit-product__input-img">
                  <input id="elccq" type="number" formControlName="elccq" />
                  <div class="edit-product__input-img-block"></div>
                </div>
              </div>

              <div class="edit-product__field">
                <label for="amazq">Amazq</label>
                <div class="edit-product__input-img">
                  <input id="amazq" type="number" formControlName="amazq" />
                  <div class="edit-product__input-img-block"></div>
                </div>
              </div>

              <div class="edit-product__field">
                <label for="notes">Notes</label>
                <div class="edit-product__input-img">
                  <input id="notes" formControlName="notes" placeholder="----------" />
                  <div class="edit-product__input-img-block"></div>
                </div>
              </div>
            </div>

            <!-- RIGHT SECTION -->
            <div class="edit-product__right">
              <div class="edit-product__images">
                <div class="edit-product__image-block">
                  <p>Photo_device</p>
                  <div class="img-wrapper">
                    <img [src]="form.get('photoDevice')?.value" alt="Device Photo" />
                  </div>
                </div>
                <div class="edit-product__image-block">
                  <p>Photo_data_plate</p>
                  <div class="img-wrapper">
                    <img [src]="form.get('photoPlate')?.value" alt="Data Plate" />
                  </div>
                </div>
              </div>
            </div>
          </div>


          <!-- ===== LIST LOCATION ===== -->
          <section class="edit-product__section">
            <h2 class="edit-product__section-title">
              List Location
              <span class="edit-product__section-count">{{ listLocation.length }}</span>
            </h2>
            <table class="edit-product__table">
              <thead>
                <tr>
                  <th style="width: 5%;">ID</th>
                  <th style="width: 10%;">Brand</th>
                  <th style="width: 10%;">Category</th>
                  <th style="width: 10%;">Device P/N</th>
                  <th style="width: 5%;">Gty</th>
                  <th style="width: 10%;">Condition</th>
                  <th style="width: 10%;">Edit User</th>
                  <th style="width: 20%;">Notes</th>
                  <th style="width: 5%;"></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let row of listLocation">
                  <td [title]="row.id">{{ row.id }}</td>
                  <td [title]="row.brand">{{ row.brand }}</td>
                  <td [title]="row.category">{{ row.category }}</td>
                  <td [title]="row.devicePN">{{ row.devicePN }}</td>
                  <td [title]="row.quantity">{{ row.quantity }}</td>
                  <td [title]="row.condition">{{ row.condition }}</td>
                  <td [title]="row.user">{{ row.user }}</td>
                  <td [title]="row.notes">{{ row.notes }}</td>
                  <td><img src="assets/icons/arrow-circle.svg" alt="expand" /></td>
                </tr>
              </tbody>
            </table>
          </section>

          <!-- ===== EBAY LISTINGS ===== -->
          <section class="edit-product__section">
            <h2 class="edit-product__section-title">
              List Ebay Vision Listings
              <span class="edit-product__section-count">{{ ebayListings.length }}</span>
            </h2>
            <table class="edit-product__table">
              <thead>
                <tr class="edit-product__ebay-listings">
                  <th style="width: 10%;">Listing_id</th>
                  <th style="width: 10%;">SKU</th>
                  <th style="width: 10%;">Condition_id</th>
                  <th style="width: 10%;">Product_id</th>
                  <th style="width: 30%;">Title</th>
                  <th style="width: 10%;">Price</th>
                  <th style="width: 10%;">Listing_qty</th>
                  <th style="width: 10%;">Inventory_qty</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let row of ebayListings">
                  <td [title]="row.id">{{ row.id }}</td>
                  <td [title]="row.sku">{{ row.sku }}</td>
                  <td [title]="row.conditionId">{{ row.conditionId }}</td>
                  <td [title]="row.productId">{{ row.productId }}</td>
                  <td [title]="row.title">{{ row.title }}</td>
                  <td [title]="row.price">{{ row.price }}</td>
                  <td [title]="row.qty">{{ row.qty }}</td>
                  <td [title]="row.inventory">{{ row.inventory }}</td>
                </tr>
              </tbody>
            </table>
          </section>

          <!-- ===== SAME PRODUCTS ===== -->
          <section class="edit-product__section">
            <h2 class="edit-product__section-title">
              Same Products
              <span class="edit-product__section-count">{{ sameProducts.length }}</span>
            </h2>
            <table class="edit-product__table">
              <thead>
                <tr class="edit-product__same-products">
                  <th style="width: 10%;">Original_id</th>
                  <th style="width: 10%;">Same_id</th>
                  <th style="width: 15%;">Fk_edit_employee</th>
                  <th style="width: 55%;"></th>
                  <th style="width: 5%;"></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let row of sameProducts">
                  <td [title]="row.originalId">{{ row.originalId }}</td>
                  <td [title]="row.sameId">{{ row.sameId }}</td>
                  <td [title]="row.editor">{{ row.editor }}</td>
                  <th></th>
                  <td><img src="assets/icons/arrow-circle.svg" alt="expand" /></td>
                </tr>
              </tbody>
            </table>
          </section>


          <!-- BOTTOM BUTTONS -->
          <div class="edit-product__bottom-actions">
            <button type="submit" class="edit-product__expand-button">Expand</button>
            <button type="button" class="edit-product__add-button">Add</button>
          </div>
        </main>
      </form>
    </ng-container>

    <ng-template #errorTpl>
      <p class="edit-product__error">Error loading product data.</p>
    </ng-template>
  </ng-template>
</div>